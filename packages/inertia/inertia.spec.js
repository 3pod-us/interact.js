import test from '@interactjs/_dev/test/test';
import drag from '@interactjs/actions/drag';
import { EventPhase } from '@interactjs/core/InteractEvent';
import * as helpers from '@interactjs/core/tests/_helpers';
import inertia from './';
test('inertia', t => {
    const { scope, interaction, target, interactable, coords, event, } = helpers.testEnv({ plugins: [inertia, drag] });
    const element = target;
    const modifierChange = 5;
    const testModifier = {
        options: { endOnly: false },
        methods: {
            set({ coords: modifierCoords, phase }) {
                modifierCoords.x = modifierChange;
                modifierCoords.y = modifierChange;
                modifierCallPhases.push(phase);
            },
        },
    };
    let fired = [];
    let modifierCallPhases = [];
    coords.client = coords.page;
    scope.now = () => coords.timeStamp;
    interactable.draggable({ inertia: true }).on('dragstart dragmove dragend draginertiastart', e => fired.push(e));
    // test inertia without modifiers or throw
    downStartMoveUp({ x: 100, y: 0, dt: 1000 });
    t.notOk(interaction.inertia.active, '{ modifiers: [] } && !thrown: inertia is not activated');
    // test inertia without modifiers and with throw
    downStartMoveUp({ x: 100, y: 0, dt: 10 });
    t.ok(interaction.inertia.active, 'thrown: inertia is activated');
    interactable.draggable({ modifiers: [testModifier] });
    // test inertia with { endOnly: false } modifier and with throw
    downStartMoveUp({ x: 100, y: 0, dt: 10 });
    t.deepEqual(modifierCallPhases, [EventPhase.Move], '{ endOnly: false } && thrown: modifier is not called from pointerUp (requireEndOnly)');
    t.deepEqual(fired.map(({ page, type }) => ({ ...page, type })), [
        { x: 0, y: 0, type: 'dragstart' },
        { x: modifierChange, y: modifierChange, type: 'dragmove' },
        { x: modifierChange, y: modifierChange, type: 'draginertiastart' },
    ], '{ endOnly: false } && thrown: move, inertiastart, and end InteractEvents are modified');
    // test inertia with { endOnly: true } modifier and with throw
    testModifier.options.endOnly = true;
    downStartMoveUp({ x: 100, y: 0, dt: 10 });
    t.deepEqual(modifierCallPhases, [EventPhase.InertiaStart], '{ endOnly: true } && thrown: modifier is called from pointerUp');
    const modified = helpers.getProps(interaction.inertia, ['modifiedXe', 'modifiedYe']);
    t.deepEqual(modified, {
        // modified target minus move coords
        modifiedXe: modifierChange - 100,
        modifiedYe: modifierChange - 0,
    }, '{ endOnly: true } && thrown: inertia target coords are correct');
    // test smoothEnd with { endOnly: false } modifier
    testModifier.options.endOnly = false;
    downStartMoveUp({ x: 1, y: 0, dt: 1000 });
    t.notOk(interaction.inertia.active, '{ endOnly: false } && !thrown: inertia smoothEnd is not activated');
    t.deepEqual(modifierCallPhases, [EventPhase.Move, EventPhase.InertiaStart], '{ endOnly: false } && !thrown: modifier is called from pointerUp');
    // test smoothEnd with { endOnly: true } modifier
    testModifier.options.endOnly = true;
    downStartMoveUp({ x: 1, y: 0, dt: 1000 });
    t.ok(interaction.inertia.active, '{ endOnly: true } && !thrown: inertia smoothEnd is activated');
    t.deepEqual(modifierCallPhases, [EventPhase.InertiaStart], '{ endOnly: true } && !thrown: modifier is called from pointerUp');
    interaction.stop();
    t.end();
    function downStartMoveUp({ x, y, dt }) {
        fired = [];
        modifierCallPhases = [];
        coords.timeStamp = 0;
        interaction.stop();
        Object.assign(coords.page, { x: 0, y: 0 });
        interaction.pointerDown(event, event, element);
        interaction.start({ name: 'drag' }, interactable, element);
        Object.assign(coords.page, { x, y });
        coords.timeStamp = dt;
        interaction.pointerMove(event, event, element);
        interaction.pointerUp(event, event, element, element);
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5lcnRpYS5zcGVjLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiaW5lcnRpYS5zcGVjLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sSUFBSSxNQUFNLDRCQUE0QixDQUFBO0FBQzdDLE9BQU8sSUFBSSxNQUFNLDBCQUEwQixDQUFBO0FBQzNDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQTtBQUMzRCxPQUFPLEtBQUssT0FBTyxNQUFNLGlDQUFpQyxDQUFBO0FBQzFELE9BQU8sT0FBTyxNQUFNLElBQUksQ0FBQTtBQUV4QixJQUFJLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxFQUFFO0lBQ2xCLE1BQU0sRUFDSixLQUFLLEVBQ0wsV0FBVyxFQUNYLE1BQU0sRUFDTixZQUFZLEVBQ1osTUFBTSxFQUNOLEtBQUssR0FDTixHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFBO0lBQ2pELE1BQU0sT0FBTyxHQUFHLE1BQXFCLENBQUE7SUFDckMsTUFBTSxjQUFjLEdBQUcsQ0FBQyxDQUFBO0lBQ3hCLE1BQU0sWUFBWSxHQUFHO1FBQ25CLE9BQU8sRUFBRSxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUU7UUFDM0IsT0FBTyxFQUFFO1lBQ1AsR0FBRyxDQUFFLEVBQUUsTUFBTSxFQUFFLGNBQWMsRUFBRSxLQUFLLEVBQUU7Z0JBQ3BDLGNBQWMsQ0FBQyxDQUFDLEdBQUcsY0FBYyxDQUFBO2dCQUNqQyxjQUFjLENBQUMsQ0FBQyxHQUFHLGNBQWMsQ0FBQTtnQkFDakMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFBO1lBQ2hDLENBQUM7U0FDRjtLQUNGLENBQUE7SUFFRCxJQUFJLEtBQUssR0FBRyxFQUFFLENBQUE7SUFDZCxJQUFJLGtCQUFrQixHQUFHLEVBQUUsQ0FBQTtJQUUzQixNQUFNLENBQUMsTUFBTSxH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LEVBQUUsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFBO1FBRTlDLFdBQVcsQ0FBQyxLQUFLLENBQUMsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLEVBQUUsWUFBWSxFQUFFLE9BQU8sQ0FBQyxDQUFBO1FBRTFELE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFBO1FBQ3BDLE1BQU0sQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFBO1FBQ3JCLFdBQVcsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQTtRQUM5QyxXQUFXLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFBO0lBQ3ZELENBQUM7QUFDSCxDQUFDLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0ZXN0IGZyb20gJ0BpbnRlcmFjdGpzL19kZXYvdGVzdC90ZXN0J1xuaW1wb3J0IGRyYWcgZnJvbSAnQGludGVyYWN0anMvYWN0aW9ucy9kcmFnJ1xuaW1wb3J0IHsgRXZlbnRQaGFzZSB9IGZyb20gJ0BpbnRlcmFjdGpzL2NvcmUvSW50ZXJhY3RFdmVudCdcbmltcG9ydCAqIGFzIGhlbHBlcnMgZnJvbSAnQGludGVyYWN0anMvY29yZS90ZXN0cy9faGVscGVycydcbmltcG9ydCBpbmVydGlhIGZyb20gJy4vJ1xuXG50ZXN0KCdpbmVydGlhJywgdCA9PiB7XG4gIGNvbnN0IHtcbiAgICBzY29wZSxcbiAgICBpbnRlcmFjdGlvbixcbiAgICB0YXJnZXQsXG4gICAgaW50ZXJhY3RhYmxlLFxuICAgIGNvb3JkcyxcbiAgICBldmVudCxcbiAgfSA9IGhlbHBlcnMudGVzdEVudih7IHBsdWdpbnM6IFtpbmVydGlhLCBkcmFnXSB9KVxuICBjb25zdCBlbGVtZW50ID0gdGFyZ2V0IGFzIEhUTUxFbGVtZW50XG4gIGNvbnN0IG1vZGlmaWVyQ2hhbmdlID0gNVxuICBjb25zdCB0ZXN0TW9kaWZpZXIgPSB7XG4gICAgb3B0aW9uczogeyBlbmRPbmx5OiBmYWxzZSB9LFxuICAgIG1ldGhvZHM6IHtcbiAgICAgIHNldCAoeyBjb29yZHM6IG1vZGlmaWVyQ29vcmRzLCBwaGFzZSB9KSB7XG4gICAgICAgIG1vZGlmaWVyQ29vcmRzLnggPSBtb2RpZmllckNoYW5nZVxuICAgICAgICBtb2RpZmllckNvb3Jkcy55ID0gbW9kaWZpZXJDaGFuZ2VcbiAgICAgICAgbW9kaWZpZXJDYWxsUGhhc2VzLnB1c2gocGhhc2UpXG4gICAgICB9LFxuICAgIH0sXG4gIH1cblxuICBsZXQgZmlyZWQgPSBbXVxuICBsZXQgbW9kaWZpZXJDYWxsUGhhc2VzID0gW11cblxuICBjb29yZHMuY2xpZW50ID0gY29vcmRzLnBhZ2VcbiAgc2NvcGUubm93ID0gKCkgPT4gY29vcmRzLnRpbWVTdGFtcFxuICBpbnRlcmFjdGFibGUuZHJhZ2dhYmxlKHsgaW5lcnRpYTogdHJ1ZSB9KS5vbignZHJhZ3N0YXJ0IGRyYWdtb3ZlIGRyYWdlbmQgZHJhZ2luZXJ0aWFzdGFydCcsIGUgPT4gZmlyZWQucHVzaChlKSlcblxuICAvLyB0ZXN0IGluZXJ0aWEgd2l0aG91dCBtb2RpZmllcnMgb3IgdGhyb3dcbiAgZG93blN0YXJ0TW92ZVVwKHsgeDogMTAwLCB5OiAwLCBkdDogMTAwMCB9KVxuICB0Lm5vdE9rKGludGVyYWN0aW9uLmluZXJ0aWEuYWN0aXZlLCAneyBtb2RpZmllcnM6IFtdIH0gJiYgIXRocm93bjogaW5lcnRpYSBpcyBub3QgYWN0aXZhdGVkJylcblxuICAvLyB0ZXN0IGluZXJ0aWEgd2l0aG91dCBtb2RpZmllcnMgYW5kIHdpdGggdGhyb3dcbiAgZG93blN0YXJ0TW92ZVVwKHsgeDogMTAwLCB5OiAwLCBkdDogMTAgfSlcbiAgdC5vayhpbnRlcmFjdGlvbi5pbmVydGlhLmFjdGl2ZSwgJ3Rocm93bjogaW5lcnRpYSBpcyBhY3RpdmF0ZWQnKVxuXG4gIGludGVyYWN0YWJsZS5kcmFnZ2FibGUoeyBtb2RpZmllcnM6IFt0ZXN0TW9kaWZpZXIgYXMgYW55XSB9KVxuXG4gIC8vIHRlc3QgaW5lcnRpYSB3aXRoIHsgZW5kT25seTogZmFsc2UgfSBtb2RpZmllciBhbmQgd2l0aCB0aHJvd1xuICBkb3duU3RhcnRNb3ZlVXAoeyB4OiAxMDAsIHk6IDAsIGR0OiAxMCB9KVxuICB0LmRlZXBFcXVhbChtb2RpZmllckNhbGxQaGFzZXMsIFtFdmVudFBoYXNlLk1vdmVdLCAneyBlbmRPbmx5OiBmYWxzZSB9ICYmIHRocm93bjogbW9kaWZpZXIgaXMgbm90IGNhbGxlZCBmcm9tIHBvaW50ZXJVcCAocmVxdWlyZUVuZE9ubHkpJylcbiAgdC5kZWVwRXF1YWwoXG4gICAgZmlyZWQubWFwKCh7IHBhZ2UsIHR5cGUgfSkgPT4gKHsgLi4ucGFnZSwgdHlwZSB9KSksXG4gICAgW1xuICAgICAgeyB4OiAwLCB5OiAwLCB0eXBlOiAnZHJhZ3N0YXJ0JyB9LFxuICAgICAgeyB4OiBtb2RpZmllckNoYW5nZSwgeTogbW9kaWZpZXJDaGFuZ2UsIHR5cGU6ICdkcmFnbW92ZScgfSxcbiAgICAgIHsgeDogbW9kaWZpZXJDaGFuZ2UsIHk6IG1vZGlmaWVyQ2hhbmdlLCB0eXBlOiAnZHJhZ2luZXJ0aWFzdGFydCcgfSxcbiAgICBdLFxuICAgICd7IGVuZE9ubHk6IGZhbHNlIH0gJiYgdGhyb3duOiBtb3ZlLCBpbmVydGlhc3RhcnQsIGFuZCBlbmQgSW50ZXJhY3RFdmVudHMgYXJlIG1vZGlmaWVkJ1xuICApXG5cbiAgLy8gdGVzdCBpbmVydGlhIHdpdGggeyBlbmRPbmx5OiB0cnVlIH0gbW9kaWZpZXIgYW5kIHdpdGggdGhyb3dcbiAgdGVzdE1vZGlmaWVyLm9wdGlvbnMuZW5kT25seSA9IHRydWVcbiAgZG93blN0YXJ0TW92ZVVwKHsgeDogMTAwLCB5OiAwLCBkdDogMTAgfSlcbiAgdC5kZWVwRXF1YWwobW9kaWZpZXJDYWxsUGhhc2VzLCBbRXZlbnRQaGFzZS5JbmVydGlhU3RhcnRdLCAneyBlbmRPbmx5OiB0cnVlIH0gJiYgdGhyb3duOiBtb2RpZmllciBpcyBjYWxsZWQgZnJvbSBwb2ludGVyVXAnKVxuICBjb25zdCBtb2RpZmllZCA9IGhlbHBlcnMuZ2V0UHJvcHMoaW50ZXJhY3Rpb24uaW5lcnRpYSwgWydtb2RpZmllZFhlJywgJ21vZGlmaWVkWWUnXSlcbiAgdC5kZWVwRXF1YWwoXG4gICAgbW9kaWZpZWQsXG4gICAge1xuICAgICAgLy8gbW9kaWZpZWQgdGFyZ2V0IG1pbnVzIG1vdmUgY29vcmRzXG4gICAgICBtb2RpZmllZFhlOiBtb2RpZmllckNoYW5nZSAtIDEwMCxcbiAgICAgIG1vZGlmaWVkWWU6IG1vZGlmaWVyQ2hhbmdlIC0gMCxcbiAgICB9LFxuICAgICd7IGVuZE9ubHk6IHRydWUgfSAmJiB0aHJvd246IGluZXJ0aWEgdGFyZ2V0IGNvb3JkcyBhcmUgY29ycmVjdCcpXG5cbiAgLy8gdGVzdCBzbW9vdGhFbmQgd2l0aCB7IGVuZE9ubHk6IGZhbHNlIH0gbW9kaWZpZXJcbiAgdGVzdE1vZGlmaWVyLm9wdGlvbnMuZW5kT25seSA9IGZhbHNlXG4gIGRvd25TdGFydE1vdmVVcCh7IHg6IDEsIHk6IDAsIGR0OiAxMDAwIH0pXG4gIHQubm90T2soaW50ZXJhY3Rpb24uaW5lcnRpYS5hY3RpdmUsICd7IGVuZE9ubHk6IGZhbHNlIH0gJiYgIXRocm93bjogaW5lcnRpYSBzbW9vdGhFbmQgaXMgbm90IGFjdGl2YXRlZCcpXG4gIHQuZGVlcEVxdWFsKG1vZGlmaWVyQ2FsbFBoYXNlcywgW0V2ZW50UGhhc2UuTW92ZSwgRXZlbnRQaGFzZS5JbmVydGlhU3RhcnRdLCAneyBlbmRPbmx5OiBmYWxzZSB9ICYmICF0aHJvd246IG1vZGlmaWVyIGlzIGNhbGxlZCBmcm9tIHBvaW50ZXJVcCcpXG5cbiAgLy8gdGVzdCBzbW9vdGhFbmQgd2l0aCB7IGVuZE9ubHk6IHRydWUgfSBtb2RpZmllclxuICB0ZXN0TW9kaWZpZXIub3B0aW9ucy5lbmRPbmx5ID0gdHJ1ZVxuICBkb3duU3RhcnRNb3ZlVXAoeyB4OiAxLCB5OiAwLCBkdDogMTAwMCB9KVxuICB0Lm9rKGludGVyYWN0aW9uLmluZXJ0aWEuYWN0aXZlLCAneyBlbmRPbmx5OiB0cnVlIH0gJiYgIXRocm93bjogaW5lcnRpYSBzbW9vdGhFbmQgaXMgYWN0aXZhdGVkJylcbiAgdC5kZWVwRXF1YWwobW9kaWZpZXJDYWxsUGhhc2VzLCBbRXZlbnRQaGFzZS5JbmVydGlhU3RhcnRdLCAneyBlbmRPbmx5OiB0cnVlIH0gJiYgIXRocm93bjogbW9kaWZpZXIgaXMgY2FsbGVkIGZyb20gcG9pbnRlclVwJylcblxuICBpbnRlcmFjdGlvbi5zdG9wKClcbiAgdC5lbmQoKVxuXG4gIGZ1bmN0aW9uIGRvd25TdGFydE1vdmVVcCAoeyB4LCB5LCBkdCB9KSB7XG4gICAgZmlyZWQgPSBbXVxuICAgIG1vZGlmaWVyQ2FsbFBoYXNlcyA9IFtdXG4gICAgY29vcmRzLnRpbWVTdGFtcCA9IDBcbiAgICBpbnRlcmFjdGlvbi5zdG9wKClcblxuICAgIE9iamVjdC5hc3NpZ24oY29vcmRzLnBhZ2UsIHsgeDogMCwgeTogMCB9KVxuICAgIGludGVyYWN0aW9uLnBvaW50ZXJEb3duKGV2ZW50LCBldmVudCwgZWxlbWVudClcblxuICAgIGludGVyYWN0aW9uLnN0YXJ0KHsgbmFtZTogJ2RyYWcnIH0sIGludGVyYWN0YWJsZSwgZWxlbWVudClcblxuICAgIE9iamVjdC5hc3NpZ24oY29vcmRzLnBhZ2UsIHsgeCwgeSB9KVxuICAgIGNvb3Jkcy50aW1lU3RhbXAgPSBkdFxuICAgIGludGVyYWN0aW9uLnBvaW50ZXJNb3ZlKGV2ZW50LCBldmVudCwgZWxlbWVudClcbiAgICBpbnRlcmFjdGlvbi5wb2ludGVyVXAoZXZlbnQsIGV2ZW50LCBlbGVtZW50LCBlbGVtZW50KVxuICB9XG59KVxuIl19