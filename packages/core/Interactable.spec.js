import d from '@interactjs/_dev/test/domator';
import test from '@interactjs/_dev/test/test';
import * as helpers from './tests/_helpers';
test('Interactable copies and extends defaults', t => {
    const scope = helpers.mockScope();
    const { defaults } = scope;
    scope.actions.methodDict = { test: 'testize' };
    scope.Interactable.prototype.testize = function (options) {
        this.setPerAction('test', options);
    };
    defaults.actions.test = {
        fromDefault: { a: 1, b: 2 },
        specified: { c: 1, d: 2 },
    };
    const specified = { specified: 'parent' };
    const div = d('div');
    const interactable = scope.interactables.new(div, { test: specified });
    t.deepEqual(interactable.options.test.specified, specified.specified, 'specified options are properly set');
    t.deepEqual(interactable.options.test.fromDefault, defaults.actions.test.fromDefault, 'default options are properly set');
    t.notEqual(interactable.options.test.fromDefault, defaults.actions.test.fromDefault, 'defaults are not aliased');
    defaults.actions.test.fromDefault.c = 3;
    t.notOk('c' in interactable.options.test.fromDefault, 'modifying defaults does not affect constructed interactables');
    t.end();
});
test('Interactable unset correctly', t => {
    const scope = helpers.mockScope();
    const div = d('div');
    const interactable = scope.interactables.new(div);
    const mappingInfo = div[scope.id][0];
    scope.interactables.signals.fire('unset', { interactable });
    t.strictEqual(mappingInfo.context, null, 'unset mappingInfo context');
    t.strictEqual(mappingInfo.interactable, null, 'unset mappingInfo interactable');
    t.strictEqual(div[scope.id].length, 0, 'unset target are removed');
    t.end();
});
test('Interactable copies and extends per action defaults', t => {
    const scope = helpers.mockScope();
    const { defaults } = scope;
    scope.actions.methodDict = { test: 'testize' };
    scope.Interactable.prototype.testize = function (options) {
        this.setPerAction('test', options);
    };
    defaults.perAction.testModifier = {
        fromDefault: { a: 1, b: 2 },
        specified: null,
    };
    defaults.actions.test = { testModifier: defaults.perAction.testModifier };
    const div = d('div');
    const interactable = scope.interactables.new(div, {});
    interactable.testize({ testModifier: { specified: 'parent' } });
    t.deepEqual(interactable.options.test, {
        enabled: false,
        origin: { x: 0, y: 0 },
        testModifier: {
            fromDefault: { a: 1, b: 2 },
            specified: 'parent',
        },
    }, 'specified options are properly set');
    t.deepEqual(interactable.options.test.testModifier.fromDefault, defaults.perAction.testModifier.fromDefault, 'default options are properly set');
    t.notEqual(interactable.options.test.testModifier.fromDefault, defaults.perAction.testModifier.fromDefault, 'defaults are not aliased');
    defaults.perAction.testModifier.fromDefault.c = 3;
    t.notOk('c' in interactable.options.test.testModifier.fromDefault, 'modifying defaults does not affect constructed interactables');
    t.end();
});
test('Interactable.updatePerActionListeners', t => {
    const scope = helpers.mockScope();
    let fired = [];
    function addToFired(event) { fired.push(event); }
    scope.actions.eventTypes.push('teststart', 'testmove', 'testend');
    scope.actions.methodDict = { test: 'testize' };
    scope.Interactable.prototype.testize = function (options) {
        this.setPerAction('test', options);
    };
    scope.defaults.actions.test = {};
    const interactable = scope.interactables.new('target');
    interactable.setPerAction('test', {
        listeners: [{
                start: addToFired,
                move: addToFired,
                end: addToFired,
            }],
    });
    interactable.fire({ type: 'teststart' });
    t.deepEqual(fired.map(e => e.type), ['teststart']);
    interactable.fire({ type: 'testmove' });
    t.deepEqual(fired.map(e => e.type), ['teststart', 'testmove']);
    interactable.fire({ type: 'testnotadded' });
    t.deepEqual(fired.map(e => e.type), ['teststart', 'testmove']);
    interactable.fire({ type: 'testend' });
    t.deepEqual(fired.map(e => e.type), ['teststart', 'testmove', 'testend']);
    fired = [];
    interactable.setPerAction('test', {
        listeners: [{ start: addToFired }],
    });
    interactable.fire({ type: 'teststart' });
    interactable.fire({ type: 'testmove' });
    interactable.fire({ type: 'testend' });
    t.deepEqual(fired.map(e => e.type), ['teststart']);
    fired = [];
    interactable.setPerAction('test', {
        listeners: null,
    });
    interactable.fire({ type: 'teststart' });
    interactable.fire({ type: 'testmove' });
    interactable.fire({ type: 'testend' });
    t.deepEqual(fired, []);
    t.end();
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW50ZXJhY3RhYmxlLnNwZWMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJJbnRlcmFjdGFibGUuc3BlYy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLENBQUMsTUFBTSwrQkFBK0IsQ0FBQTtBQUM3QyxPQUFPLElBQUksTUFBTSw0QkFBNEIsQ0FBQTtBQUM3QyxPQUFPLEtBQUssT0FBTyxNQUFNLGtCQUFrQixDQUFBO0FBRTNDLElBQUksQ0FBQywwQ0FBMEMsRUFBRSxDQUFDLENBQUMsRUFBRTtJQUNuRCxNQUFNLEtBQUssR0FBRyxPQUFPLENBQUMsU0FBUyxFQUFTLENBQUE7SUFDeEMsTUFBTSxFQUFFLFFBQVEsRUFBRSxHQUFHLEtBQUssQ0FBQTtJQUUxQixLQUFLLENBQUMsT0FBTyxDQUFDLFVBQVUsR0FBRyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsQ0FBQTtJQUU5QyxLQUFLLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxPQUFPLEdBQUcsVUFBVSxPQUFPO1FBQ3RELElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFBO0lBQ3BDLENBQUMsQ0FBQTtJQUVELFFBQVEsQ0FBQyxPQUFPLENBQUMsSUFBSSxHQUFHO1FBQ3RCLFdBQVcsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRTtRQUMzQixTQUFTLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUU7S0FDMUIsQ0FBQTtJQUVELE1BQU0sU0FBUyxHQUFHLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxDQUFBO0lBRXpDLE1BQU0sR0FBRyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQTtJQUNwQixNQUFNLFlBQVksR0FBRyxLQUFLLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQTtJ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Q0FBQyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQTtJQUVsRCxLQUFLLEdBQUcsRUFBRSxDQUFBO0lBQ1YsWUFBWSxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUU7UUFDaEMsU0FBUyxFQUFFLElBQUk7S0FDaEIsQ0FBQyxDQUFBO0lBRUYsWUFBWSxDQUFDLElBQUksQ0FBQyxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUUsQ0FBQyxDQUFBO0lBQ3hDLFlBQVksQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLENBQUMsQ0FBQTtJQUN2QyxZQUFZLENBQUMsSUFBSSxDQUFDLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUE7SUFDdEMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUE7SUFFdEIsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFBO0FBQ1QsQ0FBQyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZCBmcm9tICdAaW50ZXJhY3Rqcy9fZGV2L3Rlc3QvZG9tYXRvcidcbmltcG9ydCB0ZXN0IGZyb20gJ0BpbnRlcmFjdGpzL19kZXYvdGVzdC90ZXN0J1xuaW1wb3J0ICogYXMgaGVscGVycyBmcm9tICcuL3Rlc3RzL19oZWxwZXJzJ1xuXG50ZXN0KCdJbnRlcmFjdGFibGUgY29waWVzIGFuZCBleHRlbmRzIGRlZmF1bHRzJywgdCA9PiB7XG4gIGNvbnN0IHNjb3BlID0gaGVscGVycy5tb2NrU2NvcGUoKSBhcyBhbnlcbiAgY29uc3QgeyBkZWZhdWx0cyB9ID0gc2NvcGVcblxuICBzY29wZS5hY3Rpb25zLm1ldGhvZERpY3QgPSB7IHRlc3Q6ICd0ZXN0aXplJyB9XG5cbiAgc2NvcGUuSW50ZXJhY3RhYmxlLnByb3RvdHlwZS50ZXN0aXplID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICB0aGlzLnNldFBlckFjdGlvbigndGVzdCcsIG9wdGlvbnMpXG4gIH1cblxuICBkZWZhdWx0cy5hY3Rpb25zLnRlc3QgPSB7XG4gICAgZnJvbURlZmF1bHQ6IHsgYTogMSwgYjogMiB9LFxuICAgIHNwZWNpZmllZDogeyBjOiAxLCBkOiAyIH0sXG4gIH1cblxuICBjb25zdCBzcGVjaWZpZWQgPSB7IHNwZWNpZmllZDogJ3BhcmVudCcgfVxuXG4gIGNvbnN0IGRpdiA9IGQoJ2RpdicpXG4gIGNvbnN0IGludGVyYWN0YWJsZSA9IHNjb3BlLmludGVyYWN0YWJsZXMubmV3KGRpdiwgeyB0ZXN0OiBzcGVjaWZpZWQgfSlcblxuICB0LmRlZXBFcXVhbChpbnRlcmFjdGFibGUub3B0aW9ucy50ZXN0LnNwZWNpZmllZCwgc3BlY2lmaWVkLnNwZWNpZmllZCxcbiAgICAnc3BlY2lmaWVkIG9wdGlvbnMgYXJlIHByb3Blcmx5IHNldCcpXG4gIHQuZGVlcEVxdWFsKGludGVyYWN0YWJsZS5vcHRpb25zLnRlc3QuZnJvbURlZmF1bHQsIGRlZmF1bHRzLmFjdGlvbnMudGVzdC5mcm9tRGVmYXVsdCxcbiAgICAnZGVmYXVsdCBvcHRpb25zIGFyZSBwcm9wZXJseSBzZXQnKVxuICB0Lm5vdEVxdWFsKGludGVyYWN0YWJsZS5vcHRpb25zLnRlc3QuZnJvbURlZmF1bHQsIGRlZmF1bHRzLmFjdGlvbnMudGVzdC5mcm9tRGVmYXVsdCxcbiAgICAnZGVmYXVsdHMgYXJlIG5vdCBhbGlhc2VkJylcblxuICBkZWZhdWx0cy5hY3Rpb25zLnRlc3QuZnJvbURlZmF1bHQuYyA9IDNcbiAgdC5ub3RPaygnYycgaW4gaW50ZXJhY3RhYmxlLm9wdGlvbnMudGVzdC5mcm9tRGVmYXVsdCxcbiAgICAnbW9kaWZ5aW5nIGRlZmF1bHRzIGRvZXMgbm90IGFmZmVjdCBjb25zdHJ1Y3RlZCBpbnRlcmFjdGFibGVzJylcblxuICB0LmVuZCgpXG59KVxuXG50ZXN0KCdJbnRlcmFjdGFibGUgdW5zZXQgY29ycmVjdGx5JywgdCA9PiB7XG4gIGNvbnN0IHNjb3BlID0gaGVscGVycy5tb2NrU2NvcGUoKSBhcyBhbnlcblxuICBjb25zdCBkaXYgPSBkKCdkaXYnKVxuICBjb25zdCBpbnRlcmFjdGFibGUgPSBzY29wZS5pbnRlcmFjdGFibGVzLm5ldyhkaXYpXG5cbiAgY29uc3QgbWFwcGluZ0luZm8gPSBkaXZbc2NvcGUuaWRdWzBdXG5cbiAgc2NvcGUuaW50ZXJhY3RhYmxlcy5zaWduYWxzLmZpcmUoJ3Vuc2V0JywgeyBpbnRlcmFjdGFibGUgfSlcblxuICB0LnN0cmljdEVxdWFsKG1hcHBpbmdJbmZvLmNvbnRleHQsIG51bGwsXG4gICAgJ3Vuc2V0IG1hcHBpbmdJbmZvIGNvbnRleHQnKVxuXG4gIHQuc3RyaWN0RXF1YWwobWFwcGluZ0luZm8uaW50ZXJhY3RhYmxlLCBudWxsLFxuICAgICd1bnNldCBtYXBwaW5nSW5mbyBpbnRlcmFjdGFibGUnKVxuXG4gIHQuc3RyaWN0RXF1YWwoZGl2W3Njb3BlLmlkXS5sZW5ndGgsIDAsXG4gICAgJ3Vuc2V0IHRhcmdldCBhcmUgcmVtb3ZlZCcpXG5cbiAgdC5lbmQoKVxufSlcblxudGVzdCgnSW50ZXJhY3RhYmxlIGNvcGllcyBhbmQgZXh0ZW5kcyBwZXIgYWN0aW9uIGRlZmF1bHRzJywgdCA9PiB7XG4gIGNvbnN0IHNjb3BlID0gaGVscGVycy5tb2NrU2NvcGUoKVxuICBjb25zdCB7IGRlZmF1bHRzIH0gPSBzY29wZVxuXG4gIHNjb3BlLmFjdGlvbnMubWV0aG9kRGljdCA9IHsgdGVzdDogJ3Rlc3RpemUnIH1cblxuICBzY29wZS5JbnRlcmFjdGFibGUucHJvdG90eXBlLnRlc3RpemUgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgIHRoaXMuc2V0UGVyQWN0aW9uKCd0ZXN0Jywgb3B0aW9ucylcbiAgfVxuXG4gIGRlZmF1bHRzLnBlckFjdGlvbi50ZXN0TW9kaWZpZXIgPSB7XG4gICAgZnJvbURlZmF1bHQ6IHsgYTogMSwgYjogMiB9LFxuICAgIHNwZWNpZmllZDogbnVsbCxcbiAgfVxuICBkZWZhdWx0cy5hY3Rpb25zLnRlc3QgPSB7IHRlc3RNb2RpZmllcjogZGVmYXVsdHMucGVyQWN0aW9uLnRlc3RNb2RpZmllciB9XG5cbiAgY29uc3QgZGl2ID0gZCgnZGl2JylcbiAgY29uc3QgaW50ZXJhY3RhYmxlID0gc2NvcGUuaW50ZXJhY3RhYmxlcy5uZXcoZGl2LCB7fSlcbiAgaW50ZXJhY3RhYmxlLnRlc3RpemUoeyB0ZXN0TW9kaWZpZXI6IHsgc3BlY2lmaWVkOiAncGFyZW50JyB9IH0pXG5cbiAgdC5kZWVwRXF1YWwoaW50ZXJhY3RhYmxlLm9wdGlvbnMudGVzdCwge1xuICAgIGVuYWJsZWQ6IGZhbHNlLFxuICAgIG9yaWdpbjogeyB4OiAwLCB5OiAwIH0sXG5cbiAgICB0ZXN0TW9kaWZpZXI6IHtcbiAgICAgIGZyb21EZWZhdWx0OiB7IGE6IDEsIGI6IDIgfSxcbiAgICAgIHNwZWNpZmllZDogJ3BhcmVudCcsXG4gICAgfSxcbiAgfSwgJ3NwZWNpZmllZCBvcHRpb25zIGFyZSBwcm9wZXJseSBzZXQnKVxuICB0LmRlZXBFcXVhbChcbiAgICBpbnRlcmFjdGFibGUub3B0aW9ucy50ZXN0LnRlc3RNb2RpZmllci5mcm9tRGVmYXVsdCxcbiAgICBkZWZhdWx0cy5wZXJBY3Rpb24udGVzdE1vZGlmaWVyLmZyb21EZWZhdWx0LFxuICAgICdkZWZhdWx0IG9wdGlvbnMgYXJlIHByb3Blcmx5IHNldCcpXG4gIHQubm90RXF1YWwoXG4gICAgaW50ZXJhY3RhYmxlLm9wdGlvbnMudGVzdC50ZXN0TW9kaWZpZXIuZnJvbURlZmF1bHQsXG4gICAgZGVmYXVsdHMucGVyQWN0aW9uLnRlc3RNb2RpZmllci5mcm9tRGVmYXVsdCxcbiAgICAnZGVmYXVsdHMgYXJlIG5vdCBhbGlhc2VkJylcblxuICBkZWZhdWx0cy5wZXJBY3Rpb24udGVzdE1vZGlmaWVyLmZyb21EZWZhdWx0LmMgPSAzXG4gIHQubm90T2soJ2MnIGluIGludGVyYWN0YWJsZS5vcHRpb25zLnRlc3QudGVzdE1vZGlmaWVyLmZyb21EZWZhdWx0LFxuICAgICdtb2RpZnlpbmcgZGVmYXVsdHMgZG9lcyBub3QgYWZmZWN0IGNvbnN0cnVjdGVkIGludGVyYWN0YWJsZXMnKVxuXG4gIHQuZW5kKClcbn0pXG5cbnRlc3QoJ0ludGVyYWN0YWJsZS51cGRhdGVQZXJBY3Rpb25MaXN0ZW5lcnMnLCB0ID0+IHtcbiAgY29uc3Qgc2NvcGUgPSBoZWxwZXJzLm1vY2tTY29wZSgpXG5cbiAgbGV0IGZpcmVkID0gW11cbiAgZnVuY3Rpb24gYWRkVG9GaXJlZCAoZXZlbnQpIHsgZmlyZWQucHVzaChldmVudCkgfVxuXG4gIHNjb3BlLmFjdGlvbnMuZXZlbnRUeXBlcy5wdXNoKCd0ZXN0c3RhcnQnLCAndGVzdG1vdmUnLCAndGVzdGVuZCcpXG4gIHNjb3BlLmFjdGlvbnMubWV0aG9kRGljdCA9IHsgdGVzdDogJ3Rlc3RpemUnIH1cbiAgc2NvcGUuSW50ZXJhY3RhYmxlLnByb3RvdHlwZS50ZXN0aXplID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICB0aGlzLnNldFBlckFjdGlvbigndGVzdCcsIG9wdGlvbnMpXG4gIH1cblxuICBzY29wZS5kZWZhdWx0cy5hY3Rpb25zLnRlc3QgPSB7fVxuXG4gIGNvbnN0IGludGVyYWN0YWJsZSA9IHNjb3BlLmludGVyYWN0YWJsZXMubmV3KCd0YXJnZXQnKVxuXG4gIGludGVyYWN0YWJsZS5zZXRQZXJBY3Rpb24oJ3Rlc3QnLCB7XG4gICAgbGlzdGVuZXJzOiBbe1xuICAgICAgc3RhcnQ6IGFkZFRvRmlyZWQsXG4gICAgICBtb3ZlOiBhZGRUb0ZpcmVkLFxuICAgICAgZW5kOiBhZGRUb0ZpcmVkLFxuICAgIH1dLFxuICB9KVxuXG4gIGludGVyYWN0YWJsZS5maXJlKHsgdHlwZTogJ3Rlc3RzdGFydCcgfSlcbiAgdC5kZWVwRXF1YWwoZmlyZWQubWFwKGUgPT4gZS50eXBlKSwgWyd0ZXN0c3RhcnQnXSlcblxuICBpbnRlcmFjdGFibGUuZmlyZSh7IHR5cGU6ICd0ZXN0bW92ZScgfSlcbiAgdC5kZWVwRXF1YWwoZmlyZWQubWFwKGUgPT4gZS50eXBlKSwgWyd0ZXN0c3RhcnQnLCAndGVzdG1vdmUnXSlcblxuICBpbnRlcmFjdGFibGUuZmlyZSh7IHR5cGU6ICd0ZXN0bm90YWRkZWQnIH0pXG4gIHQuZGVlcEVxdWFsKGZpcmVkLm1hcChlID0+IGUudHlwZSksIFsndGVzdHN0YXJ0JywgJ3Rlc3Rtb3ZlJ10pXG5cbiAgaW50ZXJhY3RhYmxlLmZpcmUoeyB0eXBlOiAndGVzdGVuZCcgfSlcbiAgdC5kZWVwRXF1YWwoZmlyZWQubWFwKGUgPT4gZS50eXBlKSwgWyd0ZXN0c3RhcnQnLCAndGVzdG1vdmUnLCAndGVzdGVuZCddKVxuXG4gIGZpcmVkID0gW11cbiAgaW50ZXJhY3RhYmxlLnNldFBlckFjdGlvbigndGVzdCcsIHtcbiAgICBsaXN0ZW5lcnM6IFt7IHN0YXJ0OiBhZGRUb0ZpcmVkIH1dLFxuICB9KVxuXG4gIGludGVyYWN0YWJsZS5maXJlKHsgdHlwZTogJ3Rlc3RzdGFydCcgfSlcbiAgaW50ZXJhY3RhYmxlLmZpcmUoeyB0eXBlOiAndGVzdG1vdmUnIH0pXG4gIGludGVyYWN0YWJsZS5maXJlKHsgdHlwZTogJ3Rlc3RlbmQnIH0pXG4gIHQuZGVlcEVxdWFsKGZpcmVkLm1hcChlID0+IGUudHlwZSksIFsndGVzdHN0YXJ0J10pXG5cbiAgZmlyZWQgPSBbXVxuICBpbnRlcmFjdGFibGUuc2V0UGVyQWN0aW9uKCd0ZXN0Jywge1xuICAgIGxpc3RlbmVyczogbnVsbCxcbiAgfSlcblxuICBpbnRlcmFjdGFibGUuZmlyZSh7IHR5cGU6ICd0ZXN0c3RhcnQnIH0pXG4gIGludGVyYWN0YWJsZS5maXJlKHsgdHlwZTogJ3Rlc3Rtb3ZlJyB9KVxuICBpbnRlcmFjdGFibGUuZmlyZSh7IHR5cGU6ICd0ZXN0ZW5kJyB9KVxuICB0LmRlZXBFcXVhbChmaXJlZCwgW10pXG5cbiAgdC5lbmQoKVxufSlcbiJdfQ==