import test from '@interactjs/_dev/test/test';
import * as helpers from '@interactjs/core/tests/_helpers';
import resize from './resize';
test('resize', t => {
    const rect = Object.freeze({ left: 0, top: 0, right: 10, bottom: 10, width: 10, height: 10 });
    const { scope, interactable, interaction, event, coords, target, } = helpers.testEnv({
        plugins: [resize],
        rect,
    });
    const element = target;
    t.ok(scope.actions.names.includes('resize'), '"resize" in actions.names');
    t.equal(scope.actions.methodDict.resize, 'resizable');
    t.equal(typeof scope.Interactable.prototype.resizable, 'function', 'Interactable.resizable method is added');
    interactable.resizable({
        edges: { left: true, top: true, right: true, bottom: true },
        // use margin greater than width and height
        margin: Infinity,
    });
    // resize top left
    interaction.updatePointer(event, event, element, true);
    t.deepEqual(resize.checker(event, event, interactable, element, interaction, rect), {
        name: 'resize',
        edges: { left: true, top: true, right: false, bottom: false },
    }, 'resize top left');
    // resize top right
    coords.page.x = 10;
    interaction.updatePointer(event, event, element, true);
    t.deepEqual(resize.checker(event, event, interactable, element, interaction, rect), {
        name: 'resize',
        edges: { left: false, top: true, right: true, bottom: false },
    }, 'resize top right');
    // resize bottom right
    coords.page.y = 10;
    interaction.updatePointer(event, event, element, true);
    t.deepEqual(resize.checker(event, event, interactable, element, interaction, rect), {
        name: 'resize',
        edges: { left: false, top: false, right: true, bottom: true },
    }, 'resize bottom right');
    const zeroRect = { left: 0, top: 0, right: 0, bottom: 0, width: 0, height: 0 };
    let resizeEvent = null;
    interactable.on('resizestart resizemove resizeend', e => {
        resizeEvent = e;
    });
    coords.page.x = rect.right;
    coords.page.y = rect.bottom;
    interaction.updatePointer(event, event, element, true);
    interaction.start({ name: 'resize', edges: { bottom: true, right: true } }, interactable, element);
    t.deepEqual(interaction.resizeRects, {
        start: rect,
        current: helpers.getProps(rect, ['top', 'left', 'bottom', 'right']),
        inverted: rect,
        previous: rect,
        delta: zeroRect,
    }, 'sets starting interaction.resizeRect props');
    t.ok(hasResizeProps(resizeEvent), 'resizestart event has extra resize props');
    coords.page.x = -100;
    coords.page.y = -200;
    resizeEvent = null;
    interaction.pointerMove(event, event, element);
    t.deepEqual(interaction.resizeRects, {
        start: rect,
        current: { left: 0, top: 0, right: -100, bottom: -200 },
        inverted: zeroRect,
        previous: rect,
        delta: { ...zeroRect, right: -rect.width, bottom: -rect.bottom, width: -rect.width, height: -rect.height },
    }, "invert: 'none'");
    t.ok(hasResizeProps(resizeEvent), 'resizemove event has extra resize props');
    interactable.options.resize.invert = 'reposition';
    interaction.move();
    t.deepEqual(interaction.resizeRects, {
        start: rect,
        current: { left: 0, top: 0, right: -100, bottom: -200 },
        inverted: { ...zeroRect, left: -100, top: -200, width: 100, height: 200 },
        previous: interaction.resizeRects.previous,
        delta: { ...zeroRect, left: -100, top: -200, width: 100, height: 200 },
    }, "invert: 'reposition'");
    interactable.options.resize.invert = 'none';
    interaction.move();
    interactable.options.resize.invert = 'negate';
    interaction.move();
    t.deepEqual(interaction.resizeRects, {
        start: rect,
        current: { left: 0, top: 0, right: -100, bottom: -200 },
        inverted: { ...zeroRect, right: -100, bottom: -200, width: -100, height: -200 },
        previous: interaction.resizeRects.previous,
        delta: { ...zeroRect, right: -100, bottom: -200, width: -100, height: -200 },
    }, "invert: 'negate'");
    resizeEvent = null;
    interaction.end();
    t.ok(hasResizeProps(resizeEvent), 'resizeend event has extra resize props');
    t.end();
});
function hasResizeProps(event) {
    return !!(event.deltaRect && event.rect && event.edges);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVzaXplLnNwZWMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJyZXNpemUuc3BlYy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLElBQUksTUFBTSw0QkFBNEIsQ0FBQTtBQUM3QyxPQUFPLEtBQUssT0FBTyxNQUFNLGlDQUFpQyxDQUFBO0FBQzFELE9BQU8sTUFBTSxNQUFNLFVBQVUsQ0FBQTtBQUU3QixJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxFQUFFO0lBQ2pCLE1BQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUE7SUFDN0YsTUFBTSxFQUNKLEtBQUssRUFDTCxZQUFZLEVBQ1osV0FBVyxFQUNYLEtBQUssRUFDTCxNQUFNLEVBQ04sTUFBTSxHQUNQLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQztRQUNsQixPQUFPLEVBQUUsQ0FBQyxNQUFNLENBQUM7UUFDakIsSUFBSTtLQUNMLENBQUMsQ0FBQTtJQUVGLE1BQU0sT0FBTyxHQUFHLE1BQXFCLENBQUE7SUFFckMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsUUFBZSxDQUFDLEVBQUUsMkJBQTJCLENBQUMsQ0FBQTtJQUNoRixDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLE1BQU0sRUFBRSxXQUFXLENBQUMsQ0FBQTtJQUNyRCxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sS0FBSyxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsU0FBUyxFQUFFLFVBQVUsRUFBRSx3Q0FBd0MsQ0FBQyxDQUFBO0lBRTVHLFlBQVks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IHRlc3QgZnJvbSAnQGludGVyYWN0anMvX2Rldi90ZXN0L3Rlc3QnXG5pbXBvcnQgKiBhcyBoZWxwZXJzIGZyb20gJ0BpbnRlcmFjdGpzL2NvcmUvdGVzdHMvX2hlbHBlcnMnXG5pbXBvcnQgcmVzaXplIGZyb20gJy4vcmVzaXplJ1xuXG50ZXN0KCdyZXNpemUnLCB0ID0+IHtcbiAgY29uc3QgcmVjdCA9IE9iamVjdC5mcmVlemUoeyBsZWZ0OiAwLCB0b3A6IDAsIHJpZ2h0OiAxMCwgYm90dG9tOiAxMCwgd2lkdGg6IDEwLCBoZWlnaHQ6IDEwIH0pXG4gIGNvbnN0IHtcbiAgICBzY29wZSxcbiAgICBpbnRlcmFjdGFibGUsXG4gICAgaW50ZXJhY3Rpb24sXG4gICAgZXZlbnQsXG4gICAgY29vcmRzLFxuICAgIHRhcmdldCxcbiAgfSA9IGhlbHBlcnMudGVzdEVudih7XG4gICAgcGx1Z2luczogW3Jlc2l6ZV0sXG4gICAgcmVjdCxcbiAgfSlcblxuICBjb25zdCBlbGVtZW50ID0gdGFyZ2V0IGFzIEhUTUxFbGVtZW50XG5cbiAgdC5vayhzY29wZS5hY3Rpb25zLm5hbWVzLmluY2x1ZGVzKCdyZXNpemUnIGFzIGFueSksICdcInJlc2l6ZVwiIGluIGFjdGlvbnMubmFtZXMnKVxuICB0LmVxdWFsKHNjb3BlLmFjdGlvbnMubWV0aG9kRGljdC5yZXNpemUsICdyZXNpemFibGUnKVxuICB0LmVxdWFsKHR5cGVvZiBzY29wZS5JbnRlcmFjdGFibGUucHJvdG90eXBlLnJlc2l6YWJsZSwgJ2Z1bmN0aW9uJywgJ0ludGVyYWN0YWJsZS5yZXNpemFibGUgbWV0aG9kIGlzIGFkZGVkJylcblxuICBpbnRlcmFjdGFibGUucmVzaXphYmxlKHtcbiAgICBlZGdlczogeyBsZWZ0OiB0cnVlLCB0b3A6IHRydWUsIHJpZ2h0OiB0cnVlLCBib3R0b206IHRydWUgfSxcbiAgICAvLyB1c2UgbWFyZ2luIGdyZWF0ZXIgdGhhbiB3aWR0aCBhbmQgaGVpZ2h0XG4gICAgbWFyZ2luOiBJbmZpbml0eSxcbiAgfSlcblxuICAvLyByZXNpemUgdG9wIGxlZnRcbiAgaW50ZXJhY3Rpb24udXBkYXRlUG9pbnRlcihldmVudCwgZXZlbnQsIGVsZW1lbnQsIHRydWUpXG5cbiAgdC5kZWVwRXF1YWwoXG4gICAgcmVzaXplLmNoZWNrZXIoZXZlbnQsIGV2ZW50LCBpbnRlcmFjdGFibGUsIGVsZW1lbnQsIGludGVyYWN0aW9uLCByZWN0KSxcbiAgICB7XG4gICAgICBuYW1lOiAncmVzaXplJyxcbiAgICAgIGVkZ2VzOiB7IGxlZnQ6IHRydWUsIHRvcDogdHJ1ZSwgcmlnaHQ6IGZhbHNlLCBib3R0b206IGZhbHNlIH0sXG4gICAgfSxcbiAgICAncmVzaXplIHRvcCBsZWZ0JyxcbiAgKVxuXG4gIC8vIHJlc2l6ZSB0b3AgcmlnaHRcbiAgY29vcmRzLnBhZ2UueCA9IDEwXG4gIGludGVyYWN0aW9uLnVwZGF0ZVBvaW50ZXIoZXZlbnQsIGV2ZW50LCBlbGVtZW50LCB0cnVlKVxuXG4gIHQuZGVlcEVxdWFsKFxuICAgIHJlc2l6ZS5jaGVja2VyKGV2ZW50LCBldmVudCwgaW50ZXJhY3RhYmxlLCBlbGVtZW50LCBpbnRlcmFjdGlvbiwgcmVjdCksXG4gICAge1xuICAgICAgbmFtZTogJ3Jlc2l6ZScsXG4gICAgICBlZGdlczogeyBsZWZ0OiBmYWxzZSwgdG9wOiB0cnVlLCByaWdodDogdHJ1ZSwgYm90dG9tOiBmYWxzZSB9LFxuICAgIH0sXG4gICAgJ3Jlc2l6ZSB0b3AgcmlnaHQnLFxuICApXG5cbiAgLy8gcmVzaXplIGJvdHRvbSByaWdodFxuICBjb29yZHMucGFnZS55ID0gMTBcbiAgaW50ZXJhY3Rpb24udXBkYXRlUG9pbnRlcihldmVudCwgZXZlbnQsIGVsZW1lbnQsIHRydWUpXG5cbiAgdC5kZWVwRXF1YWwoXG4gICAgcmVzaXplLmNoZWNrZXIoZXZlbnQsIGV2ZW50LCBpbnRlcmFjdGFibGUsIGVsZW1lbnQsIGludGVyYWN0aW9uLCByZWN0KSxcbiAgICB7XG4gICAgICBuYW1lOiAncmVzaXplJyxcbiAgICAgIGVkZ2VzOiB7IGxlZnQ6IGZhbHNlLCB0b3A6IGZhbHNlLCByaWdodDogdHJ1ZSwgYm90dG9tOiB0cnVlIH0sXG4gICAgfSxcbiAgICAncmVzaXplIGJvdHRvbSByaWdodCcsXG4gIClcblxuICBjb25zdCB6ZXJvUmVjdCA9IHsgbGVmdDogMCwgdG9wOiAwLCByaWdodDogMCwgYm90dG9tOiAwLCB3aWR0aDogMCwgaGVpZ2h0OiAwIH1cbiAgbGV0IHJlc2l6ZUV2ZW50OiBJbnRlcmFjdC5SZXNpemVFdmVudCA9IG51bGxcblxuICBpbnRlcmFjdGFibGUub24oJ3Jlc2l6ZXN0YXJ0IHJlc2l6ZW1vdmUgcmVzaXplZW5kJywgZSA9PiB7XG4gICAgcmVzaXplRXZlbnQgPSBlXG4gIH0pXG5cbiAgY29vcmRzLnBhZ2UueCA9IHJlY3QucmlnaHRcbiAgY29vcmRzLnBhZ2UueSA9IHJlY3QuYm90dG9tXG4gIGludGVyYWN0aW9uLnVwZGF0ZVBvaW50ZXIoZXZlbnQsIGV2ZW50LCBlbGVtZW50LCB0cnVlKVxuICBpbnRlcmFjdGlvbi5zdGFydCh7IG5hbWU6ICdyZXNpemUnLCBlZGdlczogeyBib3R0b206IHRydWUsIHJpZ2h0OiB0cnVlIH0gfSwgaW50ZXJhY3RhYmxlLCBlbGVtZW50KVxuXG4gIHQuZGVlcEVxdWFsKFxuICAgIGludGVyYWN0aW9uLnJlc2l6ZVJlY3RzLFxuICAgIHtcbiAgICAgIHN0YXJ0OiByZWN0LFxuICAgICAgY3VycmVudDogaGVscGVycy5nZXRQcm9wcyhyZWN0LCBbJ3RvcCcsICdsZWZ0JywgJ2JvdHRvbScsICdyaWdodCddKSxcbiAgICAgIGludmVydGVkOiByZWN0LFxuICAgICAgcHJldmlvdXM6IHJlY3QsXG4gICAgICBkZWx0YTogemVyb1JlY3QsXG4gICAgfSxcbiAgICAnc2V0cyBzdGFydGluZyBpbnRlcmFjdGlvbi5yZXNpemVSZWN0IHByb3BzJyxcbiAgKVxuICB0Lm9rKGhhc1Jlc2l6ZVByb3BzKHJlc2l6ZUV2ZW50KSwgJ3Jlc2l6ZXN0YXJ0IGV2ZW50IGhhcyBleHRyYSByZXNpemUgcHJvcHMnKVxuXG4gIGNvb3Jkcy5wYWdlLnggPSAtMTAwXG4gIGNvb3Jkcy5wYWdlLnkgPSAtMjAwXG4gIHJlc2l6ZUV2ZW50ID0gbnVsbFxuICBpbnRlcmFjdGlvbi5wb2ludGVyTW92ZShldmVudCwgZXZlbnQsIGVsZW1lbnQpXG5cbiAgdC5kZWVwRXF1YWwoXG4gICAgaW50ZXJhY3Rpb24ucmVzaXplUmVjdHMsXG4gICAge1xuICAgICAgc3RhcnQ6IHJlY3QsXG4gICAgICBjdXJyZW50OiB7IGxlZnQ6IDAsIHRvcDogMCwgcmlnaHQ6IC0xMDAsIGJvdHRvbTogLTIwMCB9LFxuICAgICAgaW52ZXJ0ZWQ6IHplcm9SZWN0LFxuICAgICAgcHJldmlvdXM6IHJlY3QsXG4gICAgICBkZWx0YTogeyAuLi56ZXJvUmVjdCwgcmlnaHQ6IC1yZWN0LndpZHRoLCBib3R0b206IC1yZWN0LmJvdHRvbSwgd2lkdGg6IC1yZWN0LndpZHRoLCBoZWlnaHQ6IC1yZWN0LmhlaWdodCB9LFxuICAgIH0sXG4gICAgXCJpbnZlcnQ6ICdub25lJ1wiLFxuICApXG4gIHQub2soaGFzUmVzaXplUHJvcHMocmVzaXplRXZlbnQpLCAncmVzaXplbW92ZSBldmVudCBoYXMgZXh0cmEgcmVzaXplIHByb3BzJylcblxuICBpbnRlcmFjdGFibGUub3B0aW9ucy5yZXNpemUuaW52ZXJ0ID0gJ3JlcG9zaXRpb24nXG4gIGludGVyYWN0aW9uLm1vdmUoKVxuXG4gIHQuZGVlcEVxdWFsKFxuICAgIGludGVyYWN0aW9uLnJlc2l6ZVJlY3RzLFxuICAgIHtcbiAgICAgIHN0YXJ0OiByZWN0LFxuICAgICAgY3VycmVudDogeyBsZWZ0OiAwLCB0b3A6IDAsIHJpZ2h0OiAtMTAwLCBib3R0b206IC0yMDAgfSxcbiAgICAgIGludmVydGVkOiB7IC4uLnplcm9SZWN0LCBsZWZ0OiAtMTAwLCB0b3A6IC0yMDAsIHdpZHRoOiAxMDAsIGhlaWdodDogMjAwIH0sXG4gICAgICBwcmV2aW91czogaW50ZXJhY3Rpb24ucmVzaXplUmVjdHMucHJldmlvdXMsIC8vIG5vdCB0ZXN0aW5nIHByZXZpb3VzXG4gICAgICBkZWx0YTogeyAuLi56ZXJvUmVjdCwgbGVmdDogLTEwMCwgdG9wOiAtMjAwLCB3aWR0aDogMTAwLCBoZWlnaHQ6IDIwMCB9LFxuICAgIH0sXG4gICAgXCJpbnZlcnQ6ICdyZXBvc2l0aW9uJ1wiLFxuICApXG5cbiAgaW50ZXJhY3RhYmxlLm9wdGlvbnMucmVzaXplLmludmVydCA9ICdub25lJ1xuICBpbnRlcmFjdGlvbi5tb3ZlKClcbiAgaW50ZXJhY3RhYmxlLm9wdGlvbnMucmVzaXplLmludmVydCA9ICduZWdhdGUnXG4gIGludGVyYWN0aW9uLm1vdmUoKVxuXG4gIHQuZGVlcEVxdWFsKFxuICAgIGludGVyYWN0aW9uLnJlc2l6ZVJlY3RzLFxuICAgIHtcbiAgICAgIHN0YXJ0OiByZWN0LFxuICAgICAgY3VycmVudDogeyBsZWZ0OiAwLCB0b3A6IDAsIHJpZ2h0OiAtMTAwLCBib3R0b206IC0yMDAgfSxcbiAgICAgIGludmVydGVkOiB7IC4uLnplcm9SZWN0LCByaWdodDogLTEwMCwgYm90dG9tOiAtMjAwLCB3aWR0aDogLTEwMCwgaGVpZ2h0OiAtMjAwIH0sXG4gICAgICBwcmV2aW91czogaW50ZXJhY3Rpb24ucmVzaXplUmVjdHMucHJldmlvdXMsIC8vIG5vdCB0ZXN0aW5nIHByZXZpb3VzXG4gICAgICBkZWx0YTogeyAuLi56ZXJvUmVjdCwgcmlnaHQ6IC0xMDAsIGJvdHRvbTogLTIwMCwgd2lkdGg6IC0xMDAsIGhlaWdodDogLTIwMCB9LFxuICAgIH0sXG4gICAgXCJpbnZlcnQ6ICduZWdhdGUnXCIsXG4gIClcblxuICByZXNpemVFdmVudCA9IG51bGxcbiAgaW50ZXJhY3Rpb24uZW5kKClcbiAgdC5vayhoYXNSZXNpemVQcm9wcyhyZXNpemVFdmVudCksICdyZXNpemVlbmQgZXZlbnQgaGFzIGV4dHJhIHJlc2l6ZSBwcm9wcycpXG5cbiAgdC5lbmQoKVxufSlcblxuZnVuY3Rpb24gaGFzUmVzaXplUHJvcHMgKGV2ZW50OiBJbnRlcmFjdC5SZXNpemVFdmVudCkge1xuICByZXR1cm4gISEoZXZlbnQuZGVsdGFSZWN0ICYmIGV2ZW50LnJlY3QgJiYgZXZlbnQuZWRnZXMpXG59XG4iXX0=