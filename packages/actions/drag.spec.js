import test from '@interactjs/_dev/test/test';
import { ActionName } from '@interactjs/core/scope';
import * as helpers from '@interactjs/core/tests/_helpers';
import { extend } from '@interactjs/utils';
import pointerUtils from '@interactjs/utils/pointerUtils';
import drag from './drag';
test('drag action init', t => {
    const scope = helpers.mockScope();
    scope.usePlugin(drag);
    t.ok(scope.actions.names.includes(ActionName.Drag), '"drag" in actions.names');
    t.equal(scope.actions.methodDict.drag, 'draggable');
    t.equal(typeof scope.Interactable.prototype.draggable, 'function');
    t.end();
});
test('Interactable.draggable method', t => {
    const interactable = {
        options: {
            drag: {},
        },
        draggable: drag.draggable,
        setPerAction: () => { calledSetPerAction = true; },
        setOnEvents: () => { calledSetOnEvents = true; },
    };
    let calledSetPerAction = false;
    let calledSetOnEvents = false;
    t.equal(interactable.draggable(), interactable.options.drag, 'interactable.draggable() returns interactable.options.drag object');
    interactable.draggable(true);
    t.ok(interactable.options.drag.enabled, 'calling `interactable.draggable(true)` enables dragging');
    interactable.draggable(false);
    t.notOk(interactable.options.drag.enabled, 'calling `interactable.draggable(false)` disables dragging');
    interactable.draggable({});
    t.ok(interactable.options.drag.enabled, 'calling `interactable.draggable({})` enables dragging');
    t.ok(calledSetOnEvents, 'calling `interactable.draggable({})` calls this.setOnEvents');
    t.ok(calledSetPerAction, 'calling `interactable.draggable({})` calls this.setPerAction');
    interactable.draggable({ enabled: false });
    t.notOk(interactable.options.drag.enabled, 'calling `interactable.draggable({ enabled: false })` disables dragging');
    const axisSettings = {
        lockAxis: ['x', 'y', 'xy', 'start'],
        startAxis: ['x', 'y', 'xy'],
    };
    for (const axis in axisSettings) {
        for (const value of axisSettings[axis]) {
            const options = {};
            options[axis] = value;
            interactable.draggable(options);
            t.equal(interactable.options.drag[axis], value, '`' + axis + ': "' + value + '"` is set correctly');
            delete interactable.options.drag[axis];
        }
    }
    t.end();
});
test('drag axis', t => {
    const scope = helpers.mockScope();
    scope.usePlugin(drag);
    const interaction = scope.interactions.new({});
    const element = {};
    const interactable = {
        options: {
            drag: {},
        },
        target: element,
    };
    const iEvent = { page: {}, client: {}, delta: {}, type: 'dragmove' };
    const opposites = { x: 'y', y: 'x' };
    const eventCoords = {
        page: { x: -1, y: -2 },
        client: { x: -3, y: -4 },
        delta: { x: -5, y: -6 },
    };
    const coords = helpers.newCoordsSet();
    resetCoords();
    interaction.prepared = { name: 'drag', axis: 'xy' };
    interaction.interact = interactable;
    t.test('xy (any direction)', tt => {
        scope.interactions.signals.fire('before-action-move', { interaction });
        tt.deepEqual(interaction.coords.start, coords.start, 'coords.start is not modified');
        tt.deepEqual(interaction.coords.delta, coords.delta, 'coords.delta is not modified');
        scope.interactions.signals.fire('action-move', { iEvent, interaction });
        tt.deepEqual(iEvent.page, eventCoords.page, 'page coords are not modified');
        tt.deepEqual(iEvent.delta, eventCoords.delta, 'delta is not modified');
        tt.end();
    });
    for (const axis in opposites) {
        const opposite = opposites[axis];
        t.test(axis + '-axis', tt => {
            resetCoords();
            interaction.prepared.axis = axis;
            scope.interactions.signals.fire('action-move', { iEvent, interaction });
            tt.deepEqual(iEvent.delta, {
                [opposite]: 0,
                [axis]: eventCoords.delta[axis],
            }, `opposite axis (${opposite}) delta is 0; target axis (${axis}) delta is not modified`);
            tt.deepEqual(iEvent.page, {
                [opposite]: coords.start.page[opposite],
                [axis]: eventCoords.page[axis],
            }, `page.${opposite} is coords.start value`);
            tt.equal(iEvent.page[axis], eventCoords.page[axis], `page.${axis} is not modified`);
            tt.equal(iEvent.client[opposite], coords.start.client[opposite], `client.${opposite} is coords.start value`);
            tt.equal(iEvent.client[axis], eventCoords.client[axis], `client.${axis} is not modified`);
            tt.end();
        });
    }
    t.end();
    function resetCoords() {
        pointerUtils.copyCoords(iEvent, eventCoords);
        extend(iEvent.delta, eventCoords.delta);
        for (const prop in coords) {
            pointerUtils.copyCoords(interaction.coords[prop], coords[prop]);
        }
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJhZy5zcGVjLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZHJhZy5zcGVjLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sSUFBSSxNQUFNLDRCQUE0QixDQUFBO0FBQzdDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQTtBQUNuRCxPQUFPLEtBQUssT0FBTyxNQUFNLGlDQUFpQyxDQUFBO0FBQzFELE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQTtBQUMxQyxPQUFPLFlBQVksTUFBTSxnQ0FBZ0MsQ0FBQTtBQUN6RCxPQUFPLElBQUksTUFBTSxRQUFRLENBQUE7QUFFekIsSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUMsQ0FBQyxFQUFFO0lBQzNCLE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQTtJQUVqQyxLQUFLLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFBO0lBRXJCLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsRUFBRSx5QkFBeUIsQ0FBQyxDQUFBO0lBQzlFLENBQUMsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLFdBQVcsQ0FBQyxDQUFBO0lBQ25ELENBQUMsQ0FBQyxLQUFLLENBQUMsT0FBTyxLQUFLLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxTQUFTLEVBQUUsVUFBVSxDQUFDLENBQUE7SUFFbEUsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFBO0FBQ1QsQ0FBQyxDQUFDLENBQUE7QUFFRixJQUFJLENBQUMsK0JBQStCLEVBQUUsQ0FBQyxDQUFDLEVBQUU7SUFDeEMsTUFBTSxZQUFZLEdBQUc7UUFDbkIsT0FBTyxFQUFFO1lBQ1AsSUFBSSxFQUFFLEVBQUU7U0FDVDtRQUNELFNBQVMsRUFBRSxJQUFJ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QyxDQUFDLENBQUE7U0FDaEU7SUFDSCxDQUFDO0FBQ0gsQ0FBQyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdGVzdCBmcm9tICdAaW50ZXJhY3Rqcy9fZGV2L3Rlc3QvdGVzdCdcbmltcG9ydCB7IEFjdGlvbk5hbWUgfSBmcm9tICdAaW50ZXJhY3Rqcy9jb3JlL3Njb3BlJ1xuaW1wb3J0ICogYXMgaGVscGVycyBmcm9tICdAaW50ZXJhY3Rqcy9jb3JlL3Rlc3RzL19oZWxwZXJzJ1xuaW1wb3J0IHsgZXh0ZW5kIH0gZnJvbSAnQGludGVyYWN0anMvdXRpbHMnXG5pbXBvcnQgcG9pbnRlclV0aWxzIGZyb20gJ0BpbnRlcmFjdGpzL3V0aWxzL3BvaW50ZXJVdGlscydcbmltcG9ydCBkcmFnIGZyb20gJy4vZHJhZydcblxudGVzdCgnZHJhZyBhY3Rpb24gaW5pdCcsIHQgPT4ge1xuICBjb25zdCBzY29wZSA9IGhlbHBlcnMubW9ja1Njb3BlKClcblxuICBzY29wZS51c2VQbHVnaW4oZHJhZylcblxuICB0Lm9rKHNjb3BlLmFjdGlvbnMubmFtZXMuaW5jbHVkZXMoQWN0aW9uTmFtZS5EcmFnKSwgJ1wiZHJhZ1wiIGluIGFjdGlvbnMubmFtZXMnKVxuICB0LmVxdWFsKHNjb3BlLmFjdGlvbnMubWV0aG9kRGljdC5kcmFnLCAnZHJhZ2dhYmxlJylcbiAgdC5lcXVhbCh0eXBlb2Ygc2NvcGUuSW50ZXJhY3RhYmxlLnByb3RvdHlwZS5kcmFnZ2FibGUsICdmdW5jdGlvbicpXG5cbiAgdC5lbmQoKVxufSlcblxudGVzdCgnSW50ZXJhY3RhYmxlLmRyYWdnYWJsZSBtZXRob2QnLCB0ID0+IHtcbiAgY29uc3QgaW50ZXJhY3RhYmxlID0ge1xuICAgIG9wdGlvbnM6IHtcbiAgICAgIGRyYWc6IHt9LFxuICAgIH0sXG4gICAgZHJhZ2dhYmxlOiBkcmFnLmRyYWdnYWJsZSxcbiAgICBzZXRQZXJBY3Rpb246ICgpID0+IHsgY2FsbGVkU2V0UGVyQWN0aW9uID0gdHJ1ZSB9LFxuICAgIHNldE9uRXZlbnRzOiAoKSA9PiB7IGNhbGxlZFNldE9uRXZlbnRzID0gdHJ1ZSB9LFxuICB9IGFzIHVua25vd24gYXMgSW50ZXJhY3QuSW50ZXJhY3RhYmxlXG4gIGxldCBjYWxsZWRTZXRQZXJBY3Rpb24gPSBmYWxzZVxuICBsZXQgY2FsbGVkU2V0T25FdmVudHMgPSBmYWxzZVxuXG4gIHQuZXF1YWwoaW50ZXJhY3RhYmxlLmRyYWdnYWJsZSgpLCBpbnRlcmFjdGFibGUub3B0aW9ucy5kcmFnLFxuICAgICdpbnRlcmFjdGFibGUuZHJhZ2dhYmxlKCkgcmV0dXJucyBpbnRlcmFjdGFibGUub3B0aW9ucy5kcmFnIG9iamVjdCcpXG5cbiAgaW50ZXJhY3RhYmxlLmRyYWdnYWJsZSh0cnVlKVxuICB0Lm9rKGludGVyYWN0YWJsZS5vcHRpb25zLmRyYWcuZW5hYmxlZCxcbiAgICAnY2FsbGluZyBgaW50ZXJhY3RhYmxlLmRyYWdnYWJsZSh0cnVlKWAgZW5hYmxlcyBkcmFnZ2luZycpXG5cbiAgaW50ZXJhY3RhYmxlLmRyYWdnYWJsZShmYWxzZSlcbiAgdC5ub3RPayhpbnRlcmFjdGFibGUub3B0aW9ucy5kcmFnLmVuYWJsZWQsXG4gICAgJ2NhbGxpbmcgYGludGVyYWN0YWJsZS5kcmFnZ2FibGUoZmFsc2UpYCBkaXNhYmxlcyBkcmFnZ2luZycpXG5cbiAgaW50ZXJhY3RhYmxlLmRyYWdnYWJsZSh7fSlcbiAgdC5vayhpbnRlcmFjdGFibGUub3B0aW9ucy5kcmFnLmVuYWJsZWQsXG4gICAgJ2NhbGxpbmcgYGludGVyYWN0YWJsZS5kcmFnZ2FibGUoe30pYCBlbmFibGVzIGRyYWdnaW5nJylcbiAgdC5vayhjYWxsZWRTZXRPbkV2ZW50cyxcbiAgICAnY2FsbGluZyBgaW50ZXJhY3RhYmxlLmRyYWdnYWJsZSh7fSlgIGNhbGxzIHRoaXMuc2V0T25FdmVudHMnKVxuICB0Lm9rKGNhbGxlZFNldFBlckFjdGlvbixcbiAgICAnY2FsbGluZyBgaW50ZXJhY3RhYmxlLmRyYWdnYWJsZSh7fSlgIGNhbGxzIHRoaXMuc2V0UGVyQWN0aW9uJylcblxuICBpbnRlcmFjdGFibGUuZHJhZ2dhYmxlKHsgZW5hYmxlZDogZmFsc2UgfSlcbiAgdC5ub3RPayhpbnRlcmFjdGFibGUub3B0aW9ucy5kcmFnLmVuYWJsZWQsXG4gICAgJ2NhbGxpbmcgYGludGVyYWN0YWJsZS5kcmFnZ2FibGUoeyBlbmFibGVkOiBmYWxzZSB9KWAgZGlzYWJsZXMgZHJhZ2dpbmcnKVxuXG4gIGNvbnN0IGF4aXNTZXR0aW5ncyA9IHtcbiAgICBsb2NrQXhpczogWyd4JywgJ3knLCAneHknLCAnc3RhcnQnXSxcbiAgICBzdGFydEF4aXM6IFsneCcsICd5JywgJ3h5J10sXG4gIH1cblxuICBmb3IgKGNvbnN0IGF4aXMgaW4gYXhpc1NldHRpbmdzKSB7XG4gICAgZm9yIChjb25zdCB2YWx1ZSBvZiBheGlzU2V0dGluZ3NbYXhpc10pIHtcbiAgICAgIGNvbnN0IG9wdGlvbnMgPSB7fVxuXG4gICAgICBvcHRpb25zW2F4aXNdID0gdmFsdWVcblxuICAgICAgaW50ZXJhY3RhYmxlLmRyYWdnYWJsZShvcHRpb25zKVxuICAgICAgdC5lcXVhbChpbnRlcmFjdGFibGUub3B0aW9ucy5kcmFnW2F4aXNdLCB2YWx1ZSxcbiAgICAgICAgJ2AnICsgYXhpcyArICc6IFwiJyArIHZhbHVlICsgJ1wiYCBpcyBzZXQgY29ycmVjdGx5JylcblxuICAgICAgZGVsZXRlIGludGVyYWN0YWJsZS5vcHRpb25zLmRyYWdbYXhpc11cbiAgICB9XG4gIH1cblxuICB0LmVuZCgpXG59KVxuXG50ZXN0KCdkcmFnIGF4aXMnLCB0ID0+IHtcbiAgY29uc3Qgc2NvcGUgPSBoZWxwZXJzLm1vY2tTY29wZSgpXG5cbiAgc2NvcGUudXNlUGx1Z2luKGRyYWcpXG5cbiAgY29uc3QgaW50ZXJhY3Rpb24gPSBzY29wZS5pbnRlcmFjdGlvbnMubmV3KHt9KVxuICBjb25zdCBlbGVtZW50ID0ge31cbiAgY29uc3QgaW50ZXJhY3RhYmxlID0ge1xuICAgIG9wdGlvbnM6IHtcbiAgICAgIGRyYWc6IHt9LFxuICAgIH0sXG4gICAgdGFyZ2V0OiBlbGVtZW50LFxuICB9IGFzIEludGVyYWN0LkludGVyYWN0YWJsZVxuICBjb25zdCBpRXZlbnQgPSB7IHBhZ2U6IHt9LCBjbGllbnQ6IHt9LCBkZWx0YToge30sIHR5cGU6ICdkcmFnbW92ZScgfSBhcyBJbnRlcmFjdC5JbnRlcmFjdEV2ZW50XG5cbiAgY29uc3Qgb3Bwb3NpdGVzID0geyB4OiAneScsIHk6ICd4JyB9XG4gIGNvbnN0IGV2ZW50Q29vcmRzID0ge1xuICAgIHBhZ2U6IHsgeDogLTEsIHk6IC0yIH0sXG4gICAgY2xpZW50OiB7IHg6IC0zLCB5OiAtNCB9LFxuICAgIGRlbHRhOiB7IHg6IC01LCB5OiAtNiB9LFxuICB9XG4gIGNvbnN0IGNvb3JkcyA9IGhlbHBlcnMubmV3Q29vcmRzU2V0KClcblxuICByZXNldENvb3JkcygpXG4gIGludGVyYWN0aW9uLnByZXBhcmVkID0geyBuYW1lOiAnZHJhZycsIGF4aXM6ICd4eScgfVxuICBpbnRlcmFjdGlvbi5pbnRlcmFjdCA9IGludGVyYWN0YWJsZVxuXG4gIHQudGVzdCgneHkgKGFueSBkaXJlY3Rpb24pJywgdHQgPT4ge1xuICAgIHNjb3BlLmludGVyYWN0aW9ucy5zaWduYWxzLmZpcmUoJ2JlZm9yZS1hY3Rpb24tbW92ZScsIHsgaW50ZXJhY3Rpb24gfSlcblxuICAgIHR0LmRlZXBFcXVhbChpbnRlcmFjdGlvbi5jb29yZHMuc3RhcnQsIGNvb3Jkcy5zdGFydCxcbiAgICAgICdjb29yZHMuc3RhcnQgaXMgbm90IG1vZGlmaWVkJylcbiAgICB0dC5kZWVwRXF1YWwoaW50ZXJhY3Rpb24uY29vcmRzLmRlbHRhLCBjb29yZHMuZGVsdGEsXG4gICAgICAnY29vcmRzLmRlbHRhIGlzIG5vdCBtb2RpZmllZCcpXG5cbiAgICBzY29wZS5pbnRlcmFjdGlvbnMuc2lnbmFscy5maXJlKCdhY3Rpb24tbW92ZScsIHsgaUV2ZW50LCBpbnRlcmFjdGlvbiB9KVxuXG4gICAgdHQuZGVlcEVxdWFsKGlFdmVudC5wYWdlLCBldmVudENvb3Jkcy5wYWdlLCAncGFnZSBjb29yZHMgYXJlIG5vdCBtb2RpZmllZCcpXG4gICAgdHQuZGVlcEVxdWFsKGlFdmVudC5kZWx0YSwgZXZlbnRDb29yZHMuZGVsdGEsICdkZWx0YSBpcyBub3QgbW9kaWZpZWQnKVxuXG4gICAgdHQuZW5kKClcbiAgfSlcblxuICBmb3IgKGNvbnN0IGF4aXMgaW4gb3Bwb3NpdGVzKSB7XG4gICAgY29uc3Qgb3Bwb3NpdGUgPSBvcHBvc2l0ZXNbYXhpc11cblxuICAgIHQudGVzdChheGlzICsgJy1heGlzJywgdHQgPT4ge1xuICAgICAgcmVzZXRDb29yZHMoKVxuICAgICAgaW50ZXJhY3Rpb24ucHJlcGFyZWQuYXhpcyA9IGF4aXMgYXMgYW55XG5cbiAgICAgIHNjb3BlLmludGVyYWN0aW9ucy5zaWduYWxzLmZpcmUoJ2FjdGlvbi1tb3ZlJywgeyBpRXZlbnQsIGludGVyYWN0aW9uIH0pXG5cbiAgICAgIHR0LmRlZXBFcXVhbChcbiAgICAgICAgaUV2ZW50LmRlbHRhLFxuICAgICAgICB7XG4gICAgICAgICAgW29wcG9zaXRlXTogMCxcbiAgICAgICAgICBbYXhpc106IGV2ZW50Q29vcmRzLmRlbHRhW2F4aXNdLFxuICAgICAgICB9LFxuICAgICAgICBgb3Bwb3NpdGUgYXhpcyAoJHtvcHBvc2l0ZX0pIGRlbHRhIGlzIDA7IHRhcmdldCBheGlzICgke2F4aXN9KSBkZWx0YSBpcyBub3QgbW9kaWZpZWRgKVxuXG4gICAgICB0dC5kZWVwRXF1YWwoXG4gICAgICAgIGlFdmVudC5wYWdlLFxuICAgICAgICB7XG4gICAgICAgICAgW29wcG9zaXRlXTogY29vcmRzLnN0YXJ0LnBhZ2Vbb3Bwb3NpdGVdLFxuICAgICAgICAgIFtheGlzXTogZXZlbnRDb29yZHMucGFnZVtheGlzXSxcbiAgICAgICAgfSxcbiAgICAgICAgYHBhZ2UuJHtvcHBvc2l0ZX0gaXMgY29vcmRzLnN0YXJ0IHZhbHVlYFxuICAgICAgKVxuXG4gICAgICB0dC5lcXVhbChcbiAgICAgICAgaUV2ZW50LnBhZ2VbYXhpc10sXG4gICAgICAgIGV2ZW50Q29vcmRzLnBhZ2VbYXhpc10sXG4gICAgICAgIGBwYWdlLiR7YXhpc30gaXMgbm90IG1vZGlmaWVkYFxuICAgICAgKVxuXG4gICAgICB0dC5lcXVhbChcbiAgICAgICAgaUV2ZW50LmNsaWVudFtvcHBvc2l0ZV0sXG4gICAgICAgIGNvb3Jkcy5zdGFydC5jbGllbnRbb3Bwb3NpdGVdLFxuICAgICAgICBgY2xpZW50LiR7b3Bwb3NpdGV9IGlzIGNvb3Jkcy5zdGFydCB2YWx1ZWBcbiAgICAgIClcbiAgICAgIHR0LmVxdWFsKFxuICAgICAgICBpRXZlbnQuY2xpZW50W2F4aXNdLFxuICAgICAgICBldmVudENvb3Jkcy5jbGllbnRbYXhpc10sXG4gICAgICAgIGBjbGllbnQuJHtheGlzfSBpcyBub3QgbW9kaWZpZWRgXG4gICAgICApXG5cbiAgICAgIHR0LmVuZCgpXG4gICAgfSlcbiAgfVxuXG4gIHQuZW5kKClcblxuICBmdW5jdGlvbiByZXNldENvb3JkcyAoKSB7XG4gICAgcG9pbnRlclV0aWxzLmNvcHlDb29yZHMoaUV2ZW50LCBldmVudENvb3JkcylcbiAgICBleHRlbmQoaUV2ZW50LmRlbHRhLCBldmVudENvb3Jkcy5kZWx0YSlcblxuICAgIGZvciAoY29uc3QgcHJvcCBpbiBjb29yZHMpIHtcbiAgICAgIHBvaW50ZXJVdGlscy5jb3B5Q29vcmRzKGludGVyYWN0aW9uLmNvb3Jkc1twcm9wXSwgY29vcmRzW3Byb3BdKVxuICAgIH1cbiAgfVxufSlcbiJdfQ==