import t from"../core/Interaction.min.js";import{Scope as e}from"../core/scope.min.js";import*as n from"../utils/index.min.js";import o from"./PointerEvent.min.js";const i={id:"pointer-events/base",install:function(t){t.pointerEvents=i,t.defaults.actions.pointerEvents=i.defaults,n.extend(t.actions.phaselessTypes,i.types)},listeners:{"interactions:new":function({interaction:t}){t.prevTap=null,t.tapTime=0},"interactions:update-pointer":function({down:t,pointerInfo:e}){if(!t&&e.hold)return;e.hold={duration:1/0,timeout:null}},"interactions:move":function({interaction:t,pointer:e,event:n,eventTarget:o,duplicate:i},a){const p=t.getPointerIndex(e);i||t.pointerIsDown&&!t.pointerWasMoved||(t.pointerIsDown&&clearTimeout(t.pointers[p].hold.timeout),r({interaction:t,pointer:e,event:n,eventTarget:o,type:"move"},a))},"interactions:down":(t,e)=>{!function({interaction:t,pointer:e,event:o,eventTarget:i,pointerIndex:a},p){const s=t.pointers[a].hold,c=n.dom.getPath(i),l={interaction:t,pointer:e,event:o,eventTarget:i,type:"hold",targets:[],path:c,node:null};for(const t of c)l.node=t,p.fire("pointerEvents:collect-targets",l);if(!l.targets.length)return;let d=1/0;for(const t of l.targets){const e=t.eventable.options.holdDuration;e<d&&(d=e)}s.duration=d,s.timeout=setTimeout(()=>{r({interaction:t,eventTarget:i,pointer:e,event:o,type:"hold"},p)},d)}(t,e),r(t,e)},"interactions:up":(t,e)=>{p(t),r(t,e),function({interaction:t,pointer:e,event:n,eventTarget:o},i){t.pointerWasMoved||r({interaction:t,eventTarget:o,pointer:e,event:n,type:"tap"},i)}(t,e)},"interactions:cancel":(t,e)=>{p(t),r(t,e)}},PointerEvent:o,fire:r,collectEventTargets:a,defaults:{holdDuration:600,ignoreFrom:null,allowFrom:null,origin:{x:0,y:0}},types:{down:!0,move:!0,up:!0,cancel:!0,tap:!0,doubletap:!0,hold:!0}};function r(t,e){const{interaction:i,pointer:p,event:s,eventTarget:c,type:l,targets:d=a(t,e)}=t,v=new o(l,p,s,c,i,e.now());e.fire("pointerEvents:new",{pointerEvent:v});const u={interaction:i,pointer:p,event:s,eventTarget:c,targets:d,type:l,pointerEvent:v};for(let t=0;t<d.length;t++){const e=d[t];for(const t in e.props||{})v[t]=e.props[t];const o=n.getOriginXY(e.eventable,e.node);if(v._subtractOrigin(o),v.eventable=e.eventable,v.currentTarget=e.node,e.eventable.fire(v),v._addOrigin(o),v.immediatePropagationStopped||v.propagationStopped&&t+1<d.length&&d[t+1].node!==v.currentTarget)break}if(e.fire("pointerEvents:fired",u),"tap"===l){const t=v.double?r({interaction:i,pointer:p,event:s,eventTarget:c,type:"doubletap"},e):v;i.prevTap=t,i.tapTime=t.timeStamp}return v}function a({interaction:t,pointer:e,event:o,eventTarget:i,type:r},a){const p=t.getPointerIndex(e),s=t.pointers[p];if("tap"===r&&(t.pointerWasMoved||!s||s.downTarget!==i))return[];const c=n.dom.getPath(i),l={interaction:t,pointer:e,event:o,eventTarget:i,type:r,path:c,targets:[],node:null};for(const t of c)l.node=t,a.fire("pointerEvents:collect-targets",l);return"hold"===r&&(l.targets=l.targets.filter(e=>e.eventable.options.holdDuration===t.pointers[p].hold.duration)),l.targets}function p({interaction:t,pointerIndex:e}){t.pointers[e].hold&&clearTimeout(t.pointers[e].hold.timeout)}export default i;
//# sourceMappingURL=base.min.js.map